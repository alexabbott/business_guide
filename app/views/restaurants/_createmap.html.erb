<!-- google maps api -->
<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvl41fmjeaBBlwgySDnKX7xPExYkID5ko">
</script>

 <script src="http://d3js.org/d3.v3.min.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true_or_false">
</script>

 <script type="text/javascript">
 
 var heatmap;
      var heatmapData = [
  {location: new google.maps.LatLng(34.017862, -118.4892), weight: -0.5},
  new google.maps.LatLng(34.013706, -118.4953),
  {location: new google.maps.LatLng(34.015661, -118.4919), weight: 2},
  {location: new google.maps.LatLng(34.018218, -118.4896), weight: 3},
  {location: new google.maps.LatLng(34.017084, -118.4936), weight: 2},
  new google.maps.LatLng(34.015422, -118.4901),
  {location: new google.maps.LatLng(34.015336, -118.4966), weight: 0.5},

  {location: new google.maps.LatLng(34.017211, -118.4939), weight: 3},
  {location: new google.maps.LatLng(34.02366, -118.4923), weight: 2},
  new google.maps.LatLng(34.013761, -118.4949),
  {location: new google.maps.LatLng(34.024381, -118.4921), weight: 0.5},
  new google.maps.LatLng(34.013878, -118.49517),
  {location: new google.maps.LatLng(34.014284, -118.4980), weight: 2},
  {location: new google.maps.LatLng(34.020093, -118.4974), weight: 3},
  {location: new google.maps.LatLng(34.02448, -118.4913), weight: 3},
  {location: new google.maps.LatLng(34.012684, -118.4960), weight: 3},
  {location: new google.maps.LatLng(34.014861, -118.4932), weight: 3},
  {location: new google.maps.LatLng(34.014472, -118.4983), weight: 3},
  {location: new google.maps.LatLng(34.017607, -118.49816), weight: 3},
  {location: new google.maps.LatLng(34.010373, -118.4933), weight: 3}
]; 


 function initialize() {
      var map;
      var elevator;
      var myOptions = {
          zoom: 13,
          center: new google.maps.LatLng(34.0500, -118.2500),
          mapTypeId: google.maps.MapTypeId.HYBRID,
          scrollwheel: false
      };
      map = new google.maps.Map($('#map-canvas')[0], myOptions);

      var pointArray = new google.maps.MVCArray(heatmapData);

      heatmap = new google.maps.visualization.HeatmapLayer({ data: pointArray});

        heatmap.setMap(map);

      var addresses = ['<%= @restaurant.location %>'];

      for (var x = 0; x < addresses.length; x++) {
          $.getJSON('http://maps.googleapis.com/maps/api/geocode/json?address='+addresses[x]+'&sensor=false', null, function (data) {
              var p = data.results[0].geometry.location
              var latlng = new google.maps.LatLng(p.lat, p.lng);
               
              var marker = new google.maps.Marker({
                  position: latlng,
                  map: map,
                  icon: 'http://i.stack.imgur.com/uFZxX.png'
              });
              
              var infowindow = new google.maps.InfoWindow({
                content: '<%= @restaurant.location %>'
              });
              infowindow.open(map, marker);
        
              // google.maps.event.addListener(marker, 'click', function() {
              //   infowindow.open(map,marker);
              // });

              map.setCenter(latlng);

          });
      }
  };
  google.maps.event.addDomListener(window, 'load', initialize);
  google.maps.event.addDomListener(window, 'page:load', initialize);
  
  </script>